<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

    <!-- PWA Meta Tags - ä½¿ç”¨ light ä¸»é¢˜é¢œè‰² -->
    <meta name="theme-color" content="#6366F1" />
    <meta name="background-color" content="#FAFAFA" />
    <meta name="description" content="æœ¬åœ°/ç¦»çº¿ç‹¼äººæ€æ¸¸æˆè¾…åŠ©å·¥å…·ï¼Œæ”¯æŒå¤šäººè”æœº" />

    <!-- PWA / iOS Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="ç‹¼äººæ€ç”µå­æ³•å®˜" />
    <meta name="format-detection" content="telephone=no" />

    <!-- WeChat X5 å†…æ ¸ (å…¶ä»–æµè§ˆå™¨å¿½ç•¥) -->
    <meta name="x5-orientation" content="portrait" />
    <meta name="x5-fullscreen" content="true" />

    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="/assets/pwa/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/pwa/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/assets/pwa/apple-touch-icon-ipad.png" />

    <!-- iOS Splash Screens (will use icon as fallback) -->
    <link rel="apple-touch-startup-image" href="/assets/pwa/icon-512.png" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/pwa/icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/pwa/icon-512.png" />

    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <title>ç‹¼äººæ€ç”µå­æ³•å®˜</title>

    <!-- Expo required reset styles -->
    <style id="expo-reset">
      /* These styles make the body full-height */
      html,
      body {
        height: 100%; /* fallback */
        height: 100dvh; /* ç°ä»£æµè§ˆå™¨åŠ¨æ€è§†å£ */
        height: calc(var(--vh, 1vh) * 100); /* JS fallback (å¾®ä¿¡ç­‰æ—§å†…æ ¸) */
      }
      /* These styles disable body scrolling if you are using <ScrollView> */
      body {
        overflow: hidden;
      }
      /* These styles make the root element full-height */
      #root {
        display: flex;
        height: 100%;
        height: 100dvh;
        height: calc(var(--vh, 1vh) * 100);
        flex: 1;
      }
    </style>

    <style>
      /* å…¨å±æ ·å¼ - ä½¿ç”¨ light ä¸»é¢˜é»˜è®¤èƒŒæ™¯è‰² */
      html,
      body,
      #root {
        width: 100%;
        margin: 0;
        padding: 0;
        background-color: #fafafa;
        /* é˜²æ­¢åŒå‡»ç¼©æ”¾å»¶è¿Ÿï¼Œæ›¿ä»£ user-scalable=noï¼ˆä¿ç•™æ— éšœç¢ç¼©æ”¾èƒ½åŠ›ï¼‰ */
        touch-action: manipulation;
      }

      /* iOS å®‰å…¨åŒºåŸŸé€‚é… */
      body {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
      }

      /* å¯åŠ¨ç”»é¢æ ·å¼ - ä½¿ç”¨ light ä¸»é¢˜ primary è‰² */
      #splash-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        height: 100dvh;
        height: calc(var(--vh, 1vh) * 100);
        background-color: #fafafa;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.3s ease-out;
      }

      #splash-screen.hidden {
        opacity: 0;
        pointer-events: none;
      }

      #splash-screen img {
        width: 120px;
        height: 120px;
        border-radius: 24px;
        animation: pulse 2s ease-in-out infinite;
      }

      #splash-screen .loading-text {
        color: #52525b;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-size: 14px;
        margin-top: 20px;
        opacity: 0.7;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.05);
          opacity: 0.8;
        }
      }

      /* å¾®ä¿¡ WebView å¼•å¯¼è’™å±‚ */
      #wechat-guide {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.92);
        z-index: 99999;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        text-align: center;
        padding: 24px;
        box-sizing: border-box;
      }

      #wechat-guide .guide-arrow {
        position: absolute;
        top: 16px;
        right: 24px;
        font-size: 48px;
        animation: bounce-arrow 1.5s ease-in-out infinite;
      }

      #wechat-guide .guide-icon {
        font-size: 64px;
        margin-bottom: 24px;
      }

      #wechat-guide .guide-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 12px;
      }

      #wechat-guide .guide-desc {
        font-size: 15px;
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.6;
        max-width: 280px;
      }

      #wechat-guide .guide-steps {
        margin-top: 24px;
        text-align: left;
        font-size: 16px;
        line-height: 2;
      }

      @keyframes bounce-arrow {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      /* ç¦ç”¨é€‰æ‹©å’Œé•¿æŒ‰èœå• */
      * {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      /* å…è®¸è¾“å…¥æ¡†é€‰æ‹© */
      input,
      textarea {
        -webkit-user-select: text;
        user-select: text;
      }
    </style>
  </head>
  <body>
    <!-- å¾®ä¿¡ WebView å¼•å¯¼ - æç¤ºç”¨æˆ·ç”¨å¤–éƒ¨æµè§ˆå™¨æ‰“å¼€ -->
    <div id="wechat-guide">
      <div class="guide-arrow">â†—</div>
      <div class="guide-icon">ğŸŒ</div>
      <div class="guide-title">è¯·ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€</div>
      <div class="guide-desc">
        å¾®ä¿¡å†…ç½®æµè§ˆå™¨åŠŸèƒ½å—é™ï¼Œè¯·ä½¿ç”¨å¤–éƒ¨æµè§ˆå™¨ä»¥è·å¾—æœ€ä½³ä½“éªŒ
      </div>
      <div class="guide-steps">
        â‘  ç‚¹å‡»å³ä¸Šè§’ <strong>â‹¯</strong> èœå•<br />
        â‘¡ é€‰æ‹©ã€Œ<strong>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</strong>ã€
      </div>
    </div>

    <!-- å¯åŠ¨ç”»é¢ -->
    <div id="splash-screen">
      <img src="/assets/pwa/icon-192.png" alt="ç‹¼äººæ€ç”µå­æ³•å®˜" />
      <div class="loading-text">åŠ è½½ä¸­...</div>
    </div>

    <div id="root"></div>

    <script>
      // å¾®ä¿¡ WebView æ£€æµ‹ï¼šå¼•å¯¼ç”¨æˆ·ç”¨å¤–éƒ¨æµè§ˆå™¨æ‰“å¼€ï¼ˆlocalhost æ’é™¤ï¼Œæ–¹ä¾¿å¼€å‘è°ƒè¯•ï¼‰
      if (/MicroMessenger/i.test(navigator.userAgent) && location.hostname !== 'localhost') {
        var guide = document.getElementById('wechat-guide');
        if (guide) guide.style.display = 'flex';
      }

      // åŠ¨æ€è§†å£é«˜åº¦ï¼ˆä¿®å¤ç§»åŠ¨æµè§ˆå™¨ 100vh ä¸å‡†ï¼Œå«å¾®ä¿¡/Safari/Chromeï¼‰
      (function () {
        function setVH() {
          document.documentElement.style.setProperty('--vh', window.innerHeight * 0.01 + 'px');
        }
        window.addEventListener('resize', setVH);
        window.addEventListener('orientationchange', setVH);
        setVH();
      })();

      // ä¸»é¢˜é¢œè‰²æ˜ å°„ï¼ˆä¸ src/theme/themes.ts ä¿æŒåŒæ­¥ï¼‰
      var THEMES = {
        light: { background: '#FAFAFA', text: '#52525B', primary: '#6366F1', isDark: false },
        minimal: { background: '#FFFFFF', text: '#666666', primary: '#000000', isDark: false },
        dark: { background: '#0F0F0F', text: '#A1A1AA', primary: '#6366F1', isDark: true },
        midnight: { background: '#0A0A0F', text: '#A78BFA', primary: '#7C3AED', isDark: true },
        blood: { background: '#111111', text: '#FCA5A5', primary: '#DC2626', isDark: true },
        discord: { background: '#36393f', text: '#b9bbbe', primary: '#5865F2', isDark: true },
        forest: { background: '#0A1510', text: '#86EFAC', primary: '#22C55E', isDark: true },
        snow: { background: '#0C1929', text: '#7DD3FC', primary: '#38BDF8', isDark: true },
      };

      // è¯»å–ç”¨æˆ·ä¿å­˜çš„ä¸»é¢˜ï¼Œåº”ç”¨åˆ° splash
      (function () {
        var themeKey = 'dark';
        var settings = localStorage.getItem('@werewolf_settings');
        if (settings) {
          try {
            var parsed = JSON.parse(settings);
            if (parsed.themeKey) themeKey = parsed.themeKey;
          } catch (e) {}
        }
        var theme = THEMES[themeKey] || THEMES.dark;

        // åº”ç”¨èƒŒæ™¯è‰²
        document.documentElement.style.backgroundColor = theme.background;
        document.body.style.backgroundColor = theme.background;

        var splash = document.getElementById('splash-screen');
        if (splash) {
          splash.style.backgroundColor = theme.background;
          var text = splash.querySelector('.loading-text');
          if (text) text.style.color = theme.text;
        }

        // æ›´æ–° theme-color meta
        var themeMeta = document.querySelector('meta[name="theme-color"]');
        if (themeMeta) themeMeta.content = theme.primary;
      })();

      // éšè—å¯åŠ¨ç”»é¢
      window.addEventListener('load', function () {
        setTimeout(function () {
          var splash = document.getElementById('splash-screen');
          if (splash) {
            splash.classList.add('hidden');
            setTimeout(function () {
              splash.remove();
            }, 300);
          }
        }, 500);
      });

      // å¼€å‘ç¯å¢ƒ + å¾®ä¿¡ WebView æ—¶æ³¨å…¥ vConsoleï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
      if (/MicroMessenger/i.test(navigator.userAgent) && location.hostname === 'localhost') {
        var s = document.createElement('script');
        s.src = 'https://unpkg.com/vconsole@latest/dist/vconsole.min.js';
        s.onload = function () {
          new window.VConsole();
        };
        document.head.appendChild(s);
      }

      // æ³¨å†Œ Service Workerï¼ˆå¦‚æœæ”¯æŒï¼‰
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function () {
          navigator.serviceWorker.register('/sw.js').catch(function (err) {
            console.log('ServiceWorker registration failed:', err);
          });
        });
      }
    </script>
  </body>
</html>
